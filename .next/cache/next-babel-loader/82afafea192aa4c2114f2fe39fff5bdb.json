{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _Array$isArray from \"@babel/runtime-corejs2/core-js/array/is-array\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { createStore, applyMiddleware, compose } from 'redux';\nimport { routerMiddleware } from 'react-router-redux';\nimport { createBrowserHistory, createMemoryHistory } from 'history';\nimport _get from 'lodash-es/get';\nimport _merge from 'lodash-es/merge';\nimport _isPlainObject from 'lodash-es/isPlainObject';\nimport reducers from 'reducers';\nexport default class StoreComponent {\n  constructor(lazyInit = false) {\n    this.history = null;\n    this.store = null;\n    this._asyncReducers = {};\n\n    if (!lazyInit) {\n      this.initStore();\n    }\n  }\n\n  init(config = {}) {\n    this.initStore(config);\n    this.configurate();\n  }\n\n  initStore(config = {}) {\n    const initialState = _objectSpread({}, !process.env.IS_NODE ? _merge(...(window.APP_REDUX_PRELOAD_STATES || [{}])) : {}, {}, config.initialState);\n\n    const createHistory = process.env.IS_NODE ? createMemoryHistory : createBrowserHistory;\n    this.history = createHistory(_objectSpread({}, _get(initialState, 'config.store.history', {}), {}, config.history));\n    this.store = createStore(reducers(), initialState, compose(applyMiddleware(({\n      getState\n    }) => next => action => this._prepare(action, next, getState)), applyMiddleware(routerMiddleware(this.history)), window.__REDUX_DEVTOOLS_EXTENSION__ ? window.__REDUX_DEVTOOLS_EXTENSION__() : f => f));\n  }\n\n  configurate() {\n    // Apply configuration\n    const customConfig = this.getState().config || {};\n\n    const components = require('components');\n\n    _merge(components.clientStorage, customConfig.clientStorage);\n\n    _merge(components.html, customConfig.html);\n\n    _merge(components.http, customConfig.http);\n\n    _merge(components.locale, customConfig.locale);\n\n    _merge(components.resource, customConfig.resource);\n\n    _merge(components.store, customConfig.store);\n\n    _merge(components.ui, customConfig.ui);\n\n    _merge(components.widget, customConfig.widget);\n  }\n\n  dispatch(action) {\n    return this.store.dispatch(action);\n  }\n\n  getState() {\n    return this.store.getState();\n  }\n\n  addReducers(asyncReducers) {\n    this._asyncReducers = _objectSpread({}, this._asyncReducers, {}, asyncReducers);\n    this.store.replaceReducer(reducers(this._asyncReducers));\n  }\n\n  errorHandler(error) {\n    throw error;\n  }\n\n  _prepare(action, dispatch, getState) {\n    // Multiple dispatch (redux-multi)\n    if (_Array$isArray(action)) {\n      return action.filter(v => v).map(p => this._prepare(p, dispatch, getState));\n    } // Function wraper (redux-thunk)\n\n\n    if (typeof action === 'function') {\n      return action(p => this._prepare(p, dispatch, getState), getState);\n    } // Promise, detect errors on rejects\n    // Detect action through instanceof Promise is not working in production mode, then used single detection by type\n\n\n    if (typeof action === 'object' && typeof action.then === 'function' && typeof action.catch === 'function') {\n      return action.then(payload => this._prepare(payload, dispatch, getState)).catch(e => {\n        this.errorHandler(e, p => this._prepare(p, dispatch, getState));\n      });\n    } // Default case\n\n\n    if (_isPlainObject(action) && action.type) {\n      if (process.env.NODE_ENV !== 'production') {\n        window.__snapshot = (window.__snapshot || []).concat({\n          action\n        });\n      }\n\n      try {\n        return dispatch(action);\n      } catch (e) {\n        this.errorHandler(e, p => this._prepare(p, dispatch, getState));\n      }\n    }\n\n    return action;\n  }\n\n}","map":{"version":3,"sources":["/usr/local/var/www/neutrino-web/node_modules/yii-steroids/components/StoreComponent.js"],"names":["createStore","applyMiddleware","compose","routerMiddleware","createBrowserHistory","createMemoryHistory","_get","_merge","_isPlainObject","reducers","StoreComponent","constructor","lazyInit","history","store","_asyncReducers","initStore","init","config","configurate","initialState","process","env","IS_NODE","window","APP_REDUX_PRELOAD_STATES","createHistory","getState","next","action","_prepare","__REDUX_DEVTOOLS_EXTENSION__","f","customConfig","components","require","clientStorage","html","http","locale","resource","ui","widget","dispatch","addReducers","asyncReducers","replaceReducer","errorHandler","error","filter","v","map","p","then","catch","payload","e","type","NODE_ENV","__snapshot","concat"],"mappings":"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","sourcesContent":["import {createStore, applyMiddleware, compose} from 'redux';\nimport {routerMiddleware} from 'react-router-redux';\nimport {createBrowserHistory, createMemoryHistory} from 'history';\nimport _get from 'lodash-es/get';\nimport _merge from 'lodash-es/merge';\nimport _isPlainObject from 'lodash-es/isPlainObject';\n\nimport reducers from 'reducers';\n\nexport default class StoreComponent {\n\n    constructor(lazyInit = false) {\n        this.history = null;\n        this.store = null;\n        this._asyncReducers = {};\n\n        if (!lazyInit) {\n            this.initStore();\n        }\n    }\n\n    init(config = {}) {\n        this.initStore(config);\n        this.configurate();\n    }\n\n    initStore(config = {}) {\n        const initialState = {\n            ...(!process.env.IS_NODE ? _merge(...(window.APP_REDUX_PRELOAD_STATES || [{}])) : {}),\n            ...config.initialState,\n        };\n        const createHistory = process.env.IS_NODE ? createMemoryHistory : createBrowserHistory;\n        this.history = createHistory({\n            ..._get(initialState, 'config.store.history', {}),\n            ...config.history\n        });\n        this.store = createStore(\n            reducers(),\n            initialState,\n            compose(\n                applyMiddleware(({getState}) => next => action => this._prepare(action, next, getState)),\n                applyMiddleware(routerMiddleware(this.history)),\n                window.__REDUX_DEVTOOLS_EXTENSION__ ? window.__REDUX_DEVTOOLS_EXTENSION__() : f => f\n            )\n        );\n    }\n\n    configurate() {\n        // Apply configuration\n        const customConfig = this.getState().config || {};\n        const components = require('components');\n        _merge(components.clientStorage, customConfig.clientStorage);\n        _merge(components.html, customConfig.html);\n        _merge(components.http, customConfig.http);\n        _merge(components.locale, customConfig.locale);\n        _merge(components.resource, customConfig.resource);\n        _merge(components.store, customConfig.store);\n        _merge(components.ui, customConfig.ui);\n        _merge(components.widget, customConfig.widget);\n    }\n\n    dispatch(action) {\n        return this.store.dispatch(action);\n    }\n\n    getState() {\n        return this.store.getState();\n    }\n\n    addReducers(asyncReducers) {\n        this._asyncReducers = {\n            ...this._asyncReducers,\n            ...asyncReducers,\n        };\n\n        this.store.replaceReducer(reducers(this._asyncReducers));\n    }\n\n    errorHandler(error) {\n        throw error;\n    }\n\n    _prepare(action, dispatch, getState) {\n        // Multiple dispatch (redux-multi)\n        if (Array.isArray(action)) {\n            return action.filter(v => v).map(p => this._prepare(p, dispatch, getState));\n        }\n\n        // Function wraper (redux-thunk)\n        if (typeof action === 'function') {\n            return action(p => this._prepare(p, dispatch, getState), getState);\n        }\n\n        // Promise, detect errors on rejects\n        // Detect action through instanceof Promise is not working in production mode, then used single detection by type\n        if (typeof action === 'object' && typeof action.then === 'function' && typeof action.catch === 'function') {\n            return action\n                .then(payload => this._prepare(payload, dispatch, getState))\n                .catch(e => {\n                    this.errorHandler(e, p => this._prepare(p, dispatch, getState));\n                });\n        }\n\n        // Default case\n        if (_isPlainObject(action) && action.type) {\n            if (process.env.NODE_ENV !== 'production') {\n                window.__snapshot = (window.__snapshot || []).concat({action});\n            }\n\n            try {\n                return dispatch(action);\n            } catch (e) {\n                this.errorHandler(e, p => this._prepare(p, dispatch, getState));\n            }\n        }\n\n        return action;\n    }\n\n}\n"]},"metadata":{},"sourceType":"module"}