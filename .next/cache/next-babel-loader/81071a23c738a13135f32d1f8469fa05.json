{"ast":null,"code":"import _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport queryString from 'query-string';\nimport _isArray from 'lodash-es/isArray';\n\nvar ResourceComponent =\n/*#__PURE__*/\nfunction () {\n  function ResourceComponent() {\n    _classCallCheck(this, ResourceComponent);\n\n    this.googleApiKey = '';\n    this.googleCaptchaSiteKey = '';\n    this._callbacks = {};\n  }\n\n  _createClass(ResourceComponent, [{\n    key: \"loadGoogleMapApi\",\n    value: function loadGoogleMapApi() {\n      var locale = require('components').locale;\n\n      if (window.google && window.google.maps) {\n        return _Promise.resolve(window.google.maps);\n      }\n\n      return this.loadScript(ResourceComponent.RESOURCE_GOOGLE_MAP_API, {\n        libraries: 'places',\n        key: this.googleApiKey,\n        language: locale.language\n      }, function () {\n        return window.google.maps;\n      });\n    }\n  }, {\n    key: \"loadYandexMap\",\n    value: function loadYandexMap() {\n      var locale = require('components').locale;\n\n      if (window.ymaps) {\n        return new _Promise(function (resolve) {\n          return window.ymaps.ready(function () {\n            return resolve(window.ymaps);\n          });\n        });\n      }\n\n      return this.loadScript(ResourceComponent.RESOURCE_YANDEX_MAP_API, {\n        lang: locale.language\n      }, function () {\n        return new _Promise(function (resolve) {\n          return window.ymaps.ready(function () {\n            return resolve(window.ymaps);\n          });\n        });\n      });\n    }\n  }, {\n    key: \"loadTwitterWidget\",\n    value: function loadTwitterWidget() {\n      if (window.twttr) {\n        return _Promise.resolve(window.twttr);\n      }\n\n      return this.loadScript(ResourceComponent.RESOURCE_TWITTER_WIDGET, {}, function () {\n        return new _Promise(function (resolve) {\n          return window.twttr.ready(function () {\n            return resolve(window.twttr);\n          });\n        });\n      });\n    }\n  }, {\n    key: \"loadGeetest\",\n    value: function loadGeetest() {\n      if (window.initGeetest) {\n        return _Promise.resolve(window.initGeetest);\n      }\n\n      return this.loadScript(ResourceComponent.RESOURCE_GEETEST_API + '?_t=' + new Date().getTime(), {}, function () {\n        return window.initGeetest;\n      });\n    }\n  }, {\n    key: \"loadScript\",\n    value: function loadScript(url, params, firstResolver) {\n      var _this = this;\n\n      if (this._callbacks[url] === true) {\n        return _Promise.resolve(firstResolver());\n      }\n\n      if (_isArray(this._callbacks[url])) {\n        return new _Promise(function (resolve) {\n          _this._callbacks[url].push(resolve);\n        });\n      }\n\n      this._callbacks[url] = []; // Append script to page\n\n      return new _Promise(function (resolve, reject) {\n        var script = document.createElement('script');\n        script.async = true;\n\n        script.onload = function () {\n          setTimeout(function () {\n            _Promise.resolve(firstResolver()).then(function (result) {\n              // Resolve current\n              resolve(result); // Resolve queue promises after current\n\n              var callbacks = _this._callbacks[url];\n              _this._callbacks[url] = true;\n              callbacks.forEach(function (callback) {\n                return callback(result);\n              });\n            })[\"catch\"](reject);\n          });\n        };\n\n        script.src = url + (params ? '?' + queryString.stringify(params) : '');\n        document.body.appendChild(script);\n      });\n    }\n  }, {\n    key: \"wait\",\n    value: function wait(condition) {\n      var timeout = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 5000;\n\n      var start = _Date$now();\n\n      var checker = function checker(resolve, reject) {\n        var result = condition();\n\n        if (result) {\n          resolve(result);\n        } else if (start + timeout > _Date$now()) {\n          reject();\n        } else {\n          setTimeout(function () {\n            return checker(resolve, reject);\n          }, 500);\n        }\n      };\n\n      return new _Promise(checker);\n    }\n  }]);\n\n  return ResourceComponent;\n}();\n\n_defineProperty(ResourceComponent, \"RESOURCE_GOOGLE_MAP_API\", '//maps.googleapis.com/maps/api/js');\n\n_defineProperty(ResourceComponent, \"RESOURCE_YANDEX_MAP_API\", 'https://api-maps.yandex.ru/2.1/');\n\n_defineProperty(ResourceComponent, \"RESOURCE_TWITTER_WIDGET\", 'https://platform.twitter.com/widgets.js');\n\n_defineProperty(ResourceComponent, \"RESOURCE_GEETEST_API\", '//static.geetest.com/static/tools/gt.js');\n\nexport { ResourceComponent as default };","map":{"version":3,"sources":["/usr/local/var/www/neutrino-web/node_modules/yii-steroids/components/ResourceComponent.js"],"names":["queryString","_isArray","ResourceComponent","googleApiKey","googleCaptchaSiteKey","_callbacks","locale","require","window","google","maps","resolve","loadScript","RESOURCE_GOOGLE_MAP_API","libraries","key","language","ymaps","ready","RESOURCE_YANDEX_MAP_API","lang","twttr","RESOURCE_TWITTER_WIDGET","initGeetest","RESOURCE_GEETEST_API","Date","getTime","url","params","firstResolver","push","reject","script","document","createElement","async","onload","setTimeout","then","result","callbacks","forEach","callback","src","stringify","body","appendChild","condition","timeout","start","checker"],"mappings":"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","sourcesContent":["import queryString from 'query-string';\nimport _isArray from 'lodash-es/isArray';\n\nexport default class ResourceComponent {\n\n    static RESOURCE_GOOGLE_MAP_API = '//maps.googleapis.com/maps/api/js';\n    static RESOURCE_YANDEX_MAP_API = 'https://api-maps.yandex.ru/2.1/';\n    static RESOURCE_TWITTER_WIDGET = 'https://platform.twitter.com/widgets.js';\n    static RESOURCE_GEETEST_API = '//static.geetest.com/static/tools/gt.js';\n\n    constructor() {\n        this.googleApiKey = '';\n        this.googleCaptchaSiteKey = '';\n\n        this._callbacks = {};\n    }\n\n    loadGoogleMapApi() {\n        const locale = require('components').locale;\n\n        if (window.google && window.google.maps) {\n            return Promise.resolve(window.google.maps);\n        }\n\n        return this.loadScript(\n            ResourceComponent.RESOURCE_GOOGLE_MAP_API,\n            {\n                libraries: 'places',\n                key: this.googleApiKey,\n                language: locale.language,\n            },\n            () => window.google.maps\n        );\n    }\n\n    loadYandexMap() {\n        const locale = require('components').locale;\n\n        if (window.ymaps) {\n            return new Promise(resolve => window.ymaps.ready(() => resolve(window.ymaps)));\n        }\n\n        return this.loadScript(\n            ResourceComponent.RESOURCE_YANDEX_MAP_API,\n            {\n                lang: locale.language,\n            },\n            () => new Promise(resolve => window.ymaps.ready(() => resolve(window.ymaps)))\n        );\n    }\n\n    loadTwitterWidget() {\n        if (window.twttr) {\n            return Promise.resolve(window.twttr);\n        }\n\n        return this.loadScript(\n            ResourceComponent.RESOURCE_TWITTER_WIDGET,\n            {},\n            () => new Promise(resolve => window.twttr.ready(() => resolve(window.twttr)))\n        );\n    }\n\n    loadGeetest() {\n        if (window.initGeetest) {\n            return Promise.resolve(window.initGeetest);\n        }\n        return this.loadScript(\n            ResourceComponent.RESOURCE_GEETEST_API + '?_t=' + (new Date()).getTime(),\n            {},\n            () => window.initGeetest\n        );\n    }\n\n    loadScript(url, params, firstResolver) {\n        if (this._callbacks[url] === true) {\n            return Promise.resolve(firstResolver());\n        }\n\n        if (_isArray(this._callbacks[url])) {\n            return new Promise(resolve => {\n                this._callbacks[url].push(resolve);\n            });\n        }\n\n        this._callbacks[url] = [];\n\n        // Append script to page\n        return new Promise((resolve, reject) => {\n            let script = document.createElement('script');\n            script.async = true;\n            script.onload = () => {\n                setTimeout(() => {\n                    Promise.resolve(firstResolver())\n                        .then(result => {\n                            // Resolve current\n                            resolve(result);\n\n                            // Resolve queue promises after current\n                            const callbacks = this._callbacks[url];\n                            this._callbacks[url] = true;\n                            callbacks.forEach(callback => callback(result));\n                        })\n                        .catch(reject);\n                });\n            };\n            script.src = url + (params ? '?' + queryString.stringify(params) : '');\n            document.body.appendChild(script);\n        });\n    }\n\n    wait(condition, timeout = 5000) {\n        const start = Date.now();\n        const checker = (resolve, reject) => {\n            const result = condition();\n            if (result) {\n                resolve(result);\n            } else if (start + timeout > Date.now()) {\n                reject();\n            } else {\n                setTimeout(() => checker(resolve, reject), 500);\n            }\n        };\n        return new Promise(checker);\n    }\n\n}\n"]},"metadata":{},"sourceType":"module"}