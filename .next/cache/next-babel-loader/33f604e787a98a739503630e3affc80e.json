{"ast":null,"code":"import _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _isFunction from 'lodash-es/isFunction';\nimport _isObject from 'lodash-es/isObject';\nimport _upperFirst from 'lodash-es/upperFirst';\nimport _merge from 'lodash-es/merge';\nimport { http } from 'components';\nimport { setMeta } from './fields';\nimport { goToPage } from './navigation';\nexport var AUTH_INIT_USER = 'AUTH_INIT_USER';\nexport var AUTH_SET_DATA = 'AUTH_SET_DATA';\nexport var AUTH_ADD_SOCIAL = 'AUTH_ADD_SOCIAL';\nvar lastInitAction = null;\nexport var init = function init(initAction) {\n  return function (dispatch, getState) {\n    lastInitAction = initAction;\n    return initAction(getState()).then(function (data) {\n      // Configure components\n      if (_isObject(data.config)) {\n        var components = require('components');\n\n        _Object$keys(data.config).map(function (name) {\n          if (components[name]) {\n            _Object$keys(data.config[name]).map(function (key) {\n              var value = data.config[name][key];\n\n              var setter = 'set' + _upperFirst(key);\n\n              if (_isFunction(components[name][setter])) {\n                components[name][setter](value);\n              } else if (_isObject(components[name][key]) && _isObject(value)) {\n                _merge(components[name][key], value);\n              } else {\n                components[name][key] = value;\n              }\n            });\n          }\n        });\n      }\n\n      return dispatch([// User auth\n      setUser(data.user), // Meta models & enums\n      data.meta && setMeta(data.meta), // User auth\n      setData(data)].filter(Boolean));\n    });\n  };\n};\nexport var login = function login(token) {\n  var redirectPageId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'root';\n  return function (dispatch) {\n    http.setAccessToken(token);\n    return dispatch(init(lastInitAction)).then(function () {\n      return dispatch(goToPage(redirectPageId));\n    });\n  };\n};\nexport var addSocial = function addSocial(social) {\n  return {\n    type: AUTH_ADD_SOCIAL,\n    social: social\n  };\n};\nexport var setUser = function setUser(user) {\n  return {\n    type: AUTH_INIT_USER,\n    user: user || null\n  };\n};\nexport var setData = function setData(data) {\n  return {\n    type: AUTH_SET_DATA,\n    data: data\n  };\n};\nexport var logout = function logout() {\n  return function (dispatch) {\n    http.setAccessToken(null);\n    return dispatch([setUser(null), goToPage('root')]);\n  };\n};","map":{"version":3,"sources":["/usr/local/var/www/neutrino-web/node_modules/yii-steroids/actions/auth.js"],"names":["_isFunction","_isObject","_upperFirst","_merge","http","setMeta","goToPage","AUTH_INIT_USER","AUTH_SET_DATA","AUTH_ADD_SOCIAL","lastInitAction","init","initAction","dispatch","getState","then","data","config","components","require","map","name","key","value","setter","setUser","user","meta","setData","filter","Boolean","login","token","redirectPageId","setAccessToken","addSocial","social","type","logout"],"mappings":"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","sourcesContent":["import _isFunction from 'lodash-es/isFunction';\nimport _isObject from 'lodash-es/isObject';\nimport _upperFirst from 'lodash-es/upperFirst';\nimport _merge from 'lodash-es/merge';\n\nimport {http} from 'components';\nimport {setMeta} from './fields';\nimport {goToPage} from './navigation';\n\nexport const AUTH_INIT_USER = 'AUTH_INIT_USER';\nexport const AUTH_SET_DATA = 'AUTH_SET_DATA';\nexport const AUTH_ADD_SOCIAL = 'AUTH_ADD_SOCIAL';\n\nlet lastInitAction = null;\n\nexport const init = (initAction) => (dispatch, getState) => {\n    lastInitAction = initAction;\n\n    return initAction(getState())\n        .then(data => {\n            // Configure components\n            if (_isObject(data.config)) {\n                const components = require('components');\n                Object.keys(data.config).map(name => {\n                    if (components[name]) {\n                        Object.keys(data.config[name]).map(key => {\n                            const value = data.config[name][key];\n                            const setter = 'set' + _upperFirst(key);\n                            if (_isFunction(components[name][setter])) {\n                                components[name][setter](value);\n                            } else if (_isObject(components[name][key]) && _isObject(value)) {\n                                _merge(components[name][key], value);\n                            } else {\n                                components[name][key] = value;\n                            }\n                        });\n                    }\n                });\n            }\n\n            return dispatch([\n                // User auth\n                setUser(data.user),\n\n                // Meta models & enums\n                data.meta && setMeta(data.meta),\n\n                // User auth\n                setData(data),\n            ].filter(Boolean));\n        });\n};\n\nexport const login = (token, redirectPageId = 'root') => dispatch => {\n    http.setAccessToken(token);\n    return dispatch(init(lastInitAction))\n        .then(() => dispatch(goToPage(redirectPageId)));\n};\n\nexport const addSocial = social => ({\n    type: AUTH_ADD_SOCIAL,\n    social,\n});\n\nexport const setUser = user => ({\n    type: AUTH_INIT_USER,\n    user: user || null,\n});\n\nexport const setData = data => ({\n    type: AUTH_SET_DATA,\n    data,\n});\n\nexport const logout = () => dispatch => {\n    http.setAccessToken(null);\n    return dispatch([\n        setUser(null),\n        goToPage('root')\n    ]);\n};\n"]},"metadata":{},"sourceType":"module"}