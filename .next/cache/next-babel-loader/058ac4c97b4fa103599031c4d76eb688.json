{"ast":null,"code":"import _Date$now from \"@babel/runtime-corejs2/core-js/date/now\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport queryString from 'query-string';\nimport _isArray from 'lodash-es/isArray';\nexport default class ResourceComponent {\n  constructor() {\n    this.googleApiKey = '';\n    this.googleCaptchaSiteKey = '';\n    this._callbacks = {};\n  }\n\n  loadGoogleMapApi() {\n    const locale = require('components').locale;\n\n    if (window.google && window.google.maps) {\n      return _Promise.resolve(window.google.maps);\n    }\n\n    return this.loadScript(ResourceComponent.RESOURCE_GOOGLE_MAP_API, {\n      libraries: 'places',\n      key: this.googleApiKey,\n      language: locale.language\n    }, () => window.google.maps);\n  }\n\n  loadYandexMap() {\n    const locale = require('components').locale;\n\n    if (window.ymaps) {\n      return new _Promise(resolve => window.ymaps.ready(() => resolve(window.ymaps)));\n    }\n\n    return this.loadScript(ResourceComponent.RESOURCE_YANDEX_MAP_API, {\n      lang: locale.language\n    }, () => new _Promise(resolve => window.ymaps.ready(() => resolve(window.ymaps))));\n  }\n\n  loadTwitterWidget() {\n    if (window.twttr) {\n      return _Promise.resolve(window.twttr);\n    }\n\n    return this.loadScript(ResourceComponent.RESOURCE_TWITTER_WIDGET, {}, () => new _Promise(resolve => window.twttr.ready(() => resolve(window.twttr))));\n  }\n\n  loadGeetest() {\n    if (window.initGeetest) {\n      return _Promise.resolve(window.initGeetest);\n    }\n\n    return this.loadScript(ResourceComponent.RESOURCE_GEETEST_API + '?_t=' + new Date().getTime(), {}, () => window.initGeetest);\n  }\n\n  loadScript(url, params, firstResolver) {\n    if (this._callbacks[url] === true) {\n      return _Promise.resolve(firstResolver());\n    }\n\n    if (_isArray(this._callbacks[url])) {\n      return new _Promise(resolve => {\n        this._callbacks[url].push(resolve);\n      });\n    }\n\n    this._callbacks[url] = []; // Append script to page\n\n    return new _Promise((resolve, reject) => {\n      let script = document.createElement('script');\n      script.async = true;\n\n      script.onload = () => {\n        setTimeout(() => {\n          _Promise.resolve(firstResolver()).then(result => {\n            // Resolve current\n            resolve(result); // Resolve queue promises after current\n\n            const callbacks = this._callbacks[url];\n            this._callbacks[url] = true;\n            callbacks.forEach(callback => callback(result));\n          }).catch(reject);\n        });\n      };\n\n      script.src = url + (params ? '?' + queryString.stringify(params) : '');\n      document.body.appendChild(script);\n    });\n  }\n\n  wait(condition, timeout = 5000) {\n    const start = _Date$now();\n\n    const checker = (resolve, reject) => {\n      const result = condition();\n\n      if (result) {\n        resolve(result);\n      } else if (start + timeout > _Date$now()) {\n        reject();\n      } else {\n        setTimeout(() => checker(resolve, reject), 500);\n      }\n    };\n\n    return new _Promise(checker);\n  }\n\n}\n\n_defineProperty(ResourceComponent, \"RESOURCE_GOOGLE_MAP_API\", '//maps.googleapis.com/maps/api/js');\n\n_defineProperty(ResourceComponent, \"RESOURCE_YANDEX_MAP_API\", 'https://api-maps.yandex.ru/2.1/');\n\n_defineProperty(ResourceComponent, \"RESOURCE_TWITTER_WIDGET\", 'https://platform.twitter.com/widgets.js');\n\n_defineProperty(ResourceComponent, \"RESOURCE_GEETEST_API\", '//static.geetest.com/static/tools/gt.js');","map":{"version":3,"sources":["/usr/local/var/www/neutrino-web/node_modules/yii-steroids/components/ResourceComponent.js"],"names":["queryString","_isArray","ResourceComponent","constructor","googleApiKey","googleCaptchaSiteKey","_callbacks","loadGoogleMapApi","locale","require","window","google","maps","resolve","loadScript","RESOURCE_GOOGLE_MAP_API","libraries","key","language","loadYandexMap","ymaps","ready","RESOURCE_YANDEX_MAP_API","lang","loadTwitterWidget","twttr","RESOURCE_TWITTER_WIDGET","loadGeetest","initGeetest","RESOURCE_GEETEST_API","Date","getTime","url","params","firstResolver","push","reject","script","document","createElement","async","onload","setTimeout","then","result","callbacks","forEach","callback","catch","src","stringify","body","appendChild","wait","condition","timeout","start","checker"],"mappings":";;;AAAA,OAAOA,WAAP,MAAwB,cAAxB;AACA,OAAOC,QAAP,MAAqB,mBAArB;AAEA,eAAe,MAAMC,iBAAN,CAAwB;AAOnCC,EAAAA,WAAW,GAAG;AACV,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKC,oBAAL,GAA4B,EAA5B;AAEA,SAAKC,UAAL,GAAkB,EAAlB;AACH;;AAEDC,EAAAA,gBAAgB,GAAG;AACf,UAAMC,MAAM,GAAGC,OAAO,CAAC,YAAD,CAAP,CAAsBD,MAArC;;AAEA,QAAIE,MAAM,CAACC,MAAP,IAAiBD,MAAM,CAACC,MAAP,CAAcC,IAAnC,EAAyC;AACrC,aAAO,SAAQC,OAAR,CAAgBH,MAAM,CAACC,MAAP,CAAcC,IAA9B,CAAP;AACH;;AAED,WAAO,KAAKE,UAAL,CACHZ,iBAAiB,CAACa,uBADf,EAEH;AACIC,MAAAA,SAAS,EAAE,QADf;AAEIC,MAAAA,GAAG,EAAE,KAAKb,YAFd;AAGIc,MAAAA,QAAQ,EAAEV,MAAM,CAACU;AAHrB,KAFG,EAOH,MAAMR,MAAM,CAACC,MAAP,CAAcC,IAPjB,CAAP;AASH;;AAEDO,EAAAA,aAAa,GAAG;AACZ,UAAMX,MAAM,GAAGC,OAAO,CAAC,YAAD,CAAP,CAAsBD,MAArC;;AAEA,QAAIE,MAAM,CAACU,KAAX,EAAkB;AACd,aAAO,aAAYP,OAAO,IAAIH,MAAM,CAACU,KAAP,CAAaC,KAAb,CAAmB,MAAMR,OAAO,CAACH,MAAM,CAACU,KAAR,CAAhC,CAAvB,CAAP;AACH;;AAED,WAAO,KAAKN,UAAL,CACHZ,iBAAiB,CAACoB,uBADf,EAEH;AACIC,MAAAA,IAAI,EAAEf,MAAM,CAACU;AADjB,KAFG,EAKH,MAAM,aAAYL,OAAO,IAAIH,MAAM,CAACU,KAAP,CAAaC,KAAb,CAAmB,MAAMR,OAAO,CAACH,MAAM,CAACU,KAAR,CAAhC,CAAvB,CALH,CAAP;AAOH;;AAEDI,EAAAA,iBAAiB,GAAG;AAChB,QAAId,MAAM,CAACe,KAAX,EAAkB;AACd,aAAO,SAAQZ,OAAR,CAAgBH,MAAM,CAACe,KAAvB,CAAP;AACH;;AAED,WAAO,KAAKX,UAAL,CACHZ,iBAAiB,CAACwB,uBADf,EAEH,EAFG,EAGH,MAAM,aAAYb,OAAO,IAAIH,MAAM,CAACe,KAAP,CAAaJ,KAAb,CAAmB,MAAMR,OAAO,CAACH,MAAM,CAACe,KAAR,CAAhC,CAAvB,CAHH,CAAP;AAKH;;AAEDE,EAAAA,WAAW,GAAG;AACV,QAAIjB,MAAM,CAACkB,WAAX,EAAwB;AACpB,aAAO,SAAQf,OAAR,CAAgBH,MAAM,CAACkB,WAAvB,CAAP;AACH;;AACD,WAAO,KAAKd,UAAL,CACHZ,iBAAiB,CAAC2B,oBAAlB,GAAyC,MAAzC,GAAmD,IAAIC,IAAJ,EAAD,CAAaC,OAAb,EAD/C,EAEH,EAFG,EAGH,MAAMrB,MAAM,CAACkB,WAHV,CAAP;AAKH;;AAEDd,EAAAA,UAAU,CAACkB,GAAD,EAAMC,MAAN,EAAcC,aAAd,EAA6B;AACnC,QAAI,KAAK5B,UAAL,CAAgB0B,GAAhB,MAAyB,IAA7B,EAAmC;AAC/B,aAAO,SAAQnB,OAAR,CAAgBqB,aAAa,EAA7B,CAAP;AACH;;AAED,QAAIjC,QAAQ,CAAC,KAAKK,UAAL,CAAgB0B,GAAhB,CAAD,CAAZ,EAAoC;AAChC,aAAO,aAAYnB,OAAO,IAAI;AAC1B,aAAKP,UAAL,CAAgB0B,GAAhB,EAAqBG,IAArB,CAA0BtB,OAA1B;AACH,OAFM,CAAP;AAGH;;AAED,SAAKP,UAAL,CAAgB0B,GAAhB,IAAuB,EAAvB,CAXmC,CAanC;;AACA,WAAO,aAAY,CAACnB,OAAD,EAAUuB,MAAV,KAAqB;AACpC,UAAIC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;AACAF,MAAAA,MAAM,CAACG,KAAP,GAAe,IAAf;;AACAH,MAAAA,MAAM,CAACI,MAAP,GAAgB,MAAM;AAClBC,QAAAA,UAAU,CAAC,MAAM;AACb,mBAAQ7B,OAAR,CAAgBqB,aAAa,EAA7B,EACKS,IADL,CACUC,MAAM,IAAI;AACZ;AACA/B,YAAAA,OAAO,CAAC+B,MAAD,CAAP,CAFY,CAIZ;;AACA,kBAAMC,SAAS,GAAG,KAAKvC,UAAL,CAAgB0B,GAAhB,CAAlB;AACA,iBAAK1B,UAAL,CAAgB0B,GAAhB,IAAuB,IAAvB;AACAa,YAAAA,SAAS,CAACC,OAAV,CAAkBC,QAAQ,IAAIA,QAAQ,CAACH,MAAD,CAAtC;AACH,WATL,EAUKI,KAVL,CAUWZ,MAVX;AAWH,SAZS,CAAV;AAaH,OAdD;;AAeAC,MAAAA,MAAM,CAACY,GAAP,GAAajB,GAAG,IAAIC,MAAM,GAAG,MAAMjC,WAAW,CAACkD,SAAZ,CAAsBjB,MAAtB,CAAT,GAAyC,EAAnD,CAAhB;AACAK,MAAAA,QAAQ,CAACa,IAAT,CAAcC,WAAd,CAA0Bf,MAA1B;AACH,KApBM,CAAP;AAqBH;;AAEDgB,EAAAA,IAAI,CAACC,SAAD,EAAYC,OAAO,GAAG,IAAtB,EAA4B;AAC5B,UAAMC,KAAK,GAAG,WAAd;;AACA,UAAMC,OAAO,GAAG,CAAC5C,OAAD,EAAUuB,MAAV,KAAqB;AACjC,YAAMQ,MAAM,GAAGU,SAAS,EAAxB;;AACA,UAAIV,MAAJ,EAAY;AACR/B,QAAAA,OAAO,CAAC+B,MAAD,CAAP;AACH,OAFD,MAEO,IAAIY,KAAK,GAAGD,OAAR,GAAkB,WAAtB,EAAkC;AACrCnB,QAAAA,MAAM;AACT,OAFM,MAEA;AACHM,QAAAA,UAAU,CAAC,MAAMe,OAAO,CAAC5C,OAAD,EAAUuB,MAAV,CAAd,EAAiC,GAAjC,CAAV;AACH;AACJ,KATD;;AAUA,WAAO,aAAYqB,OAAZ,CAAP;AACH;;AAzHkC;;gBAAlBvD,iB,6BAEgB,mC;;gBAFhBA,iB,6BAGgB,iC;;gBAHhBA,iB,6BAIgB,yC;;gBAJhBA,iB,0BAKa,yC","sourcesContent":["import queryString from 'query-string';\nimport _isArray from 'lodash-es/isArray';\n\nexport default class ResourceComponent {\n\n    static RESOURCE_GOOGLE_MAP_API = '//maps.googleapis.com/maps/api/js';\n    static RESOURCE_YANDEX_MAP_API = 'https://api-maps.yandex.ru/2.1/';\n    static RESOURCE_TWITTER_WIDGET = 'https://platform.twitter.com/widgets.js';\n    static RESOURCE_GEETEST_API = '//static.geetest.com/static/tools/gt.js';\n\n    constructor() {\n        this.googleApiKey = '';\n        this.googleCaptchaSiteKey = '';\n\n        this._callbacks = {};\n    }\n\n    loadGoogleMapApi() {\n        const locale = require('components').locale;\n\n        if (window.google && window.google.maps) {\n            return Promise.resolve(window.google.maps);\n        }\n\n        return this.loadScript(\n            ResourceComponent.RESOURCE_GOOGLE_MAP_API,\n            {\n                libraries: 'places',\n                key: this.googleApiKey,\n                language: locale.language,\n            },\n            () => window.google.maps\n        );\n    }\n\n    loadYandexMap() {\n        const locale = require('components').locale;\n\n        if (window.ymaps) {\n            return new Promise(resolve => window.ymaps.ready(() => resolve(window.ymaps)));\n        }\n\n        return this.loadScript(\n            ResourceComponent.RESOURCE_YANDEX_MAP_API,\n            {\n                lang: locale.language,\n            },\n            () => new Promise(resolve => window.ymaps.ready(() => resolve(window.ymaps)))\n        );\n    }\n\n    loadTwitterWidget() {\n        if (window.twttr) {\n            return Promise.resolve(window.twttr);\n        }\n\n        return this.loadScript(\n            ResourceComponent.RESOURCE_TWITTER_WIDGET,\n            {},\n            () => new Promise(resolve => window.twttr.ready(() => resolve(window.twttr)))\n        );\n    }\n\n    loadGeetest() {\n        if (window.initGeetest) {\n            return Promise.resolve(window.initGeetest);\n        }\n        return this.loadScript(\n            ResourceComponent.RESOURCE_GEETEST_API + '?_t=' + (new Date()).getTime(),\n            {},\n            () => window.initGeetest\n        );\n    }\n\n    loadScript(url, params, firstResolver) {\n        if (this._callbacks[url] === true) {\n            return Promise.resolve(firstResolver());\n        }\n\n        if (_isArray(this._callbacks[url])) {\n            return new Promise(resolve => {\n                this._callbacks[url].push(resolve);\n            });\n        }\n\n        this._callbacks[url] = [];\n\n        // Append script to page\n        return new Promise((resolve, reject) => {\n            let script = document.createElement('script');\n            script.async = true;\n            script.onload = () => {\n                setTimeout(() => {\n                    Promise.resolve(firstResolver())\n                        .then(result => {\n                            // Resolve current\n                            resolve(result);\n\n                            // Resolve queue promises after current\n                            const callbacks = this._callbacks[url];\n                            this._callbacks[url] = true;\n                            callbacks.forEach(callback => callback(result));\n                        })\n                        .catch(reject);\n                });\n            };\n            script.src = url + (params ? '?' + queryString.stringify(params) : '');\n            document.body.appendChild(script);\n        });\n    }\n\n    wait(condition, timeout = 5000) {\n        const start = Date.now();\n        const checker = (resolve, reject) => {\n            const result = condition();\n            if (result) {\n                resolve(result);\n            } else if (start + timeout > Date.now()) {\n                reject();\n            } else {\n                setTimeout(() => checker(resolve, reject), 500);\n            }\n        };\n        return new Promise(checker);\n    }\n\n}\n"]},"metadata":{},"sourceType":"module"}