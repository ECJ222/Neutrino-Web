{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport _get from 'lodash-es/get';\nimport { http, clientStorage } from 'components';\nexport const LIST_INIT = 'LIST_INIT';\nexport const LIST_BEFORE_FETCH = 'LIST_BEFORE_FETCH';\nexport const LIST_AFTER_FETCH = 'LIST_AFTER_FETCH';\nexport const LIST_ITEM_ADD = 'LIST_ITEM_ADD';\nexport const LIST_ITEM_UPDATE = 'LIST_ITEM_UPDATE';\nexport const LIST_DESTROY = 'LIST_DESTROY';\nexport const LIST_TOGGLE_ITEM = 'LIST_TOGGLE_ITEM';\nexport const LIST_TOGGLE_ALL = 'LIST_TOGGLE_ALL';\nexport const LIST_SET_LAYOUT = 'LIST_SET_LAYOUT';\nconst STORAGE_LAYOUT_KEY_PREFIX = 'listLayout_';\nconst lazyTimers = {};\n\nconst defaultFetchHandler = list => {\n  let url = list.action;\n\n  if (list.scope) {\n    url += (url.indexOf('?') !== -1 ? '&' : '?') + 'scope=' + list.scope.join(',');\n  }\n\n  return http.send(list.actionMethod, url || location.pathname, _objectSpread({}, list.query, {\n    page: list.page,\n    pageSize: list.pageSize,\n    sort: list.sort\n  })).then(response => response.data);\n};\n\nexport const init = (listId, props) => dispatch => dispatch({\n  action: props.action || props.action === '' ? props.action : null,\n  actionMethod: props.actionMethod || 'post',\n  onFetch: props.onFetch,\n  scope: props.scope,\n  page: props.defaultPage,\n  pageSize: props.defaultPageSize,\n  sort: props.defaultSort || null,\n  total: props.total || null,\n  query: props.query || null,\n  items: props.items || null,\n  loadMore: props.loadMore,\n  primaryKey: props.primaryKey,\n  layoutName: clientStorage.get(STORAGE_LAYOUT_KEY_PREFIX + listId) || props.selectedLayoutName || _get(props, 'layoutNames.0.id') || null,\n  listId,\n  type: LIST_INIT\n});\nexport const fetch = (listId, params = {}) => (dispatch, getState) => {\n  const list = _objectSpread({}, _get(getState(), ['list', 'lists', listId]), {}, params);\n\n  if (!list.action && list.action !== '') {\n    return;\n  }\n\n  const onFetch = list.onFetch || defaultFetchHandler;\n  return dispatch([_objectSpread({}, params, {\n    listId,\n    type: LIST_BEFORE_FETCH\n  }), onFetch(list).then(data => {\n    if (!getState().list.lists[listId]) {\n      return [];\n    }\n\n    return _objectSpread({}, data, {\n      listId,\n      type: LIST_AFTER_FETCH\n    });\n  })]);\n};\nexport const lazyFetch = (listId, params) => dispatch => {\n  if (lazyTimers[listId]) {\n    clearTimeout(lazyTimers[listId]);\n  }\n\n  lazyTimers[listId] = setTimeout(() => dispatch(fetch(listId, params)), 200);\n};\nexport const setPage = (listId, page, loadMore) => fetch(listId, {\n  page,\n  loadMore\n});\nexport const setPageSize = (listId, pageSize) => fetch(listId, {\n  page: 1,\n  pageSize\n});\nexport const setSort = (listId, sort) => fetch(listId, {\n  sort\n});\nexport const refresh = listId => fetch(listId);\nexport const add = (listId, item) => ({\n  item,\n  listId,\n  type: LIST_ITEM_ADD\n});\nexport const update = (listId, item, condition) => ({\n  item,\n  condition,\n  listId,\n  type: LIST_ITEM_UPDATE\n});\nexport const destroy = listId => {\n  if (lazyTimers[listId]) {\n    clearTimeout(lazyTimers[listId]);\n  }\n\n  return {\n    listId,\n    type: LIST_DESTROY\n  };\n};\nexport const toggleItem = (listId, itemId) => ({\n  listId,\n  itemId,\n  type: LIST_TOGGLE_ITEM\n});\nexport const toggleAll = listId => ({\n  listId,\n  type: LIST_TOGGLE_ALL\n});\nexport const setLayoutName = (listId, layoutName) => {\n  clientStorage.set(STORAGE_LAYOUT_KEY_PREFIX + listId, layoutName);\n  return {\n    listId,\n    layoutName,\n    type: LIST_SET_LAYOUT\n  };\n};","map":{"version":3,"sources":["/usr/local/var/www/neutrino-web/node_modules/yii-steroids/actions/list.js"],"names":["_get","http","clientStorage","LIST_INIT","LIST_BEFORE_FETCH","LIST_AFTER_FETCH","LIST_ITEM_ADD","LIST_ITEM_UPDATE","LIST_DESTROY","LIST_TOGGLE_ITEM","LIST_TOGGLE_ALL","LIST_SET_LAYOUT","STORAGE_LAYOUT_KEY_PREFIX","lazyTimers","defaultFetchHandler","list","url","action","scope","indexOf","join","send","actionMethod","location","pathname","query","page","pageSize","sort","then","response","data","init","listId","props","dispatch","onFetch","defaultPage","defaultPageSize","defaultSort","total","items","loadMore","primaryKey","layoutName","get","selectedLayoutName","type","fetch","params","getState","lists","lazyFetch","clearTimeout","setTimeout","setPage","setPageSize","setSort","refresh","add","item","update","condition","destroy","toggleItem","itemId","toggleAll","setLayoutName","set"],"mappings":"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","sourcesContent":["import _get from 'lodash-es/get';\n\nimport {http, clientStorage} from 'components';\n\nexport const LIST_INIT = 'LIST_INIT';\nexport const LIST_BEFORE_FETCH = 'LIST_BEFORE_FETCH';\nexport const LIST_AFTER_FETCH = 'LIST_AFTER_FETCH';\nexport const LIST_ITEM_ADD = 'LIST_ITEM_ADD';\nexport const LIST_ITEM_UPDATE = 'LIST_ITEM_UPDATE';\nexport const LIST_DESTROY = 'LIST_DESTROY';\nexport const LIST_TOGGLE_ITEM = 'LIST_TOGGLE_ITEM';\nexport const LIST_TOGGLE_ALL = 'LIST_TOGGLE_ALL';\nexport const LIST_SET_LAYOUT = 'LIST_SET_LAYOUT';\n\nconst STORAGE_LAYOUT_KEY_PREFIX = 'listLayout_';\n\nconst lazyTimers = {};\n\nconst defaultFetchHandler = list => {\n    let url = list.action;\n    if (list.scope) {\n        url += (url.indexOf('?') !== -1 ? '&' : '?') + 'scope=' + list.scope.join(',');\n    }\n\n    return http.send(list.actionMethod, url || location.pathname, {\n        ...list.query,\n        page: list.page,\n        pageSize: list.pageSize,\n        sort: list.sort,\n    })\n        .then(response => response.data);\n};\n\nexport const init = (listId, props) => dispatch => dispatch({\n    action: props.action || props.action === '' ? props.action : null,\n    actionMethod: props.actionMethod || 'post',\n    onFetch: props.onFetch,\n    scope: props.scope,\n    page: props.defaultPage,\n    pageSize: props.defaultPageSize,\n    sort: props.defaultSort || null,\n    total: props.total || null,\n    query: props.query || null,\n    items: props.items || null,\n    loadMore: props.loadMore,\n    primaryKey: props.primaryKey,\n    layoutName: clientStorage.get(STORAGE_LAYOUT_KEY_PREFIX + listId) || props.selectedLayoutName || _get(props, 'layoutNames.0.id') || null,\n    listId,\n    type: LIST_INIT,\n});\n\nexport const fetch = (listId, params = {}) => (dispatch, getState) => {\n    const list = {\n        ..._get(getState(), ['list', 'lists', listId]),\n        ...params,\n    };\n    if (!list.action && list.action !== '') {\n        return;\n    }\n\n    const onFetch = list.onFetch || defaultFetchHandler;\n\n    return dispatch([\n        {\n            ...params,\n            listId,\n            type: LIST_BEFORE_FETCH,\n        },\n        onFetch(list).then(data => {\n            if (!getState().list.lists[listId]) {\n                return [];\n            }\n\n            return {\n                ...data,\n                listId,\n                type: LIST_AFTER_FETCH,\n            };\n        }),\n    ]);\n};\n\nexport const lazyFetch = (listId, params) => dispatch => {\n    if (lazyTimers[listId]) {\n        clearTimeout(lazyTimers[listId]);\n    }\n    lazyTimers[listId] = setTimeout(() => dispatch(fetch(listId, params)), 200);\n};\n\nexport const setPage = (listId, page, loadMore) => fetch(listId, {\n    page,\n    loadMore,\n});\n\nexport const setPageSize = (listId, pageSize) => fetch(listId, {\n    page: 1,\n    pageSize,\n});\n\nexport const setSort = (listId, sort) => fetch(listId, {\n    sort,\n});\n\nexport const refresh = listId => fetch(listId);\n\nexport const add = (listId, item) => ({\n    item,\n    listId,\n    type: LIST_ITEM_ADD,\n});\n\nexport const update = (listId, item, condition) => ({\n    item,\n    condition,\n    listId,\n    type: LIST_ITEM_UPDATE,\n});\n\nexport const destroy = listId => {\n    if (lazyTimers[listId]) {\n        clearTimeout(lazyTimers[listId]);\n    }\n\n    return {\n        listId,\n        type: LIST_DESTROY,\n    };\n};\n\nexport const toggleItem = (listId, itemId) => ({\n    listId,\n    itemId,\n    type: LIST_TOGGLE_ITEM,\n});\n\nexport const toggleAll = listId => ({\n    listId,\n    type: LIST_TOGGLE_ALL,\n});\n\nexport const setLayoutName = (listId, layoutName) => {\n    clientStorage.set(STORAGE_LAYOUT_KEY_PREFIX + listId, layoutName);\n    return {\n        listId,\n        layoutName,\n        type: LIST_SET_LAYOUT,\n    };\n};\n"]},"metadata":{},"sourceType":"module"}